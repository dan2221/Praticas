-- TAREFA 10 - BANCO DE DADOS

CREATE TABLE EST_CLIENTE
(CPF	VARCHAR(14),
NOME	VARCHAR(40),
NASCTO	DATETIME,
CONSTRAINT		PK_CLIENTE PRIMARY KEY(CPF));

CREATE TABLE EST_MODELO
(CODMOD	INT,
DESCR	VARCHAR(40),
CONSTRAINT		PK_MODELO PRIMARY KEY(CODMOD));

CREATE TABLE EST_VEICULO
(PLACA		VARCHAR(8),
CLIENTE_CPF	VARCHAR(14),
MODELO		INT,
COR			VARCHAR(20),
ANO			INT,
CONSTRAINT		PK_VEICULO PRIMARY KEY(PLACA),
CONSTRAINT		FK_CLIENTE FOREIGN KEY(CLIENTE_CPF)
	REFERENCES EST_CLIENTE(CPF),
CONSTRAINT		FK_MODELO FOREIGN KEY(MODELO)
	REFERENCES EST_MODELO(CODMOD));

CREATE TABLE EST_PATIO
(NUM		INT,
ENDER		VARCHAR(40),
CAPACIDADE	INT,
CONSTRAINT		PK_PATIO PRIMARY KEY(NUM));

CREATE TABLE EST_ESTACIONA
(CODIGO		INT,
PATIO_NUM	INT,
PLACA_VEIC	VARCHAR(8),
DATA_ENTR	DATETIME,
DATA_SAIDA	DATETIME,
HORA_ENTR	VARCHAR(10),
HORA_SAIDA	VARCHAR(10),
CONSTRAINT		PK_ESTACIONA PRIMARY KEY(CODIGO),
CONSTRAINT		FK_VEICULO FOREIGN KEY(PLACA_VEIC)
	REFERENCES EST_VEICULO(PLACA),
CONSTRAINT		FK_PATIO FOREIGN KEY(PATIO_NUM)
	REFERENCES EST_PATIO(NUM));


--INSERIR 5 REGISTROS EM CADA TABELA
INSERT INTO EST_CLIENTE VALUES
('393.090.292-09','OBI WAN KENOBI','19850522'),
('564.434.212-11','ANAKIN SKYWALKER','19780809'),
('321.456.987-00','LUKE SKYWALKER','19850522'),
('512.322.114-98','LÉIA ORGANA','19780809'),
('300.877.530-97','PADMÉ AMIDALA','19820615');

INSERT INTO EST_MODELO VALUES
(1,'CORSA'),
(2,'CIVIC'),
(3,'HB20'),
(4,'CELTA'),
(5,'KA');

INSERT INTO EST_VEICULO VALUES
('FJO-4567','393.090.292-09',1,'AZUL MARINHO',1990),
('JJJ-2020','564.434.212-11',2,'VERMELHO',1992),
('PUT-2102','321.456.987-00',3,'VERDE',2004),
('CAK-1313','512.322.114-98',4,'BRANCO',2006),
('JEX-1010','300.877.530-97',5,'VERDE',2010); 

INSERT INTO EST_PATIO VALUES
(1,'AV. JOSÉ LIMA, 231',18),
(2,'R. SANTO JOSÉ, 97', 34),
(3,'R. OSWALDO CRUZ, 121', 22),
(4,'AV. SANTA CONCEIÇÃO, 76', 26),
(5,'R. SÃO PEDRO, 167', 20);

INSERT INTO EST_ESTACIONA VALUES
(1,1,'FJO-4567', '20220428','20220428','14:00','16:30'),
(2,2,'JJJ-2020', '20220423','20220423','08:00','14:10'),
(3,3,'PUT-2102', '20220421','20220422','23:30','07:30'),
(4,4,'CAK-1313', '20220425','20220425','14:00','16:30'),
(5,5,'JEX-1010', '20220424','20220425','22:00','00:30');

-- c) EXIBA A PLACA E O NOME DO DONO DE TODOS OS VEÍCULOS
SELECT EST_VEICULO.PLACA, EST_CLIENTE.NOME
FROM EST_CLIENTE INNER JOIN EST_VEICULO
ON EST_CLIENTE.CPF = EST_VEICULO.CLIENTE_CPF;

-- D) EXIBA O CPF E O NOME DO CLIENTE QUE POSSUI O VEÍCULO DE PLACA JJJ-2020
SELECT EST_CLIENTE.CPF, EST_CLIENTE.NOME
FROM EST_CLIENTE INNER JOIN EST_VEICULO
ON EST_CLIENTE.CPF = EST_VEICULO.CLIENTE_CPF
WHERE EST_VEICULO.PLACA = 'JJJ-2020';

-- E) EXIBA A PLACA E A COR DO VEÍCULO QUE POSSUI O CÓDIGO DE ESTACIONAMENTO 1
SELECT EST_VEICULO.PLACA, EST_VEICULO.COR
FROM EST_VEICULO INNER JOIN EST_ESTACIONA
ON EST_ESTACIONA.PLACA_VEIC = EST_VEICULO.PLACA
WHERE EST_ESTACIONA.CODIGO = '1';

-- F) EXIBA A PLACA E O ANO DO VEÍCULO QUE POSSUI O CÓDIGO DE ESTACIONAMENTO 1
SELECT EST_VEICULO.PLACA, EST_VEICULO.ANO
FROM EST_VEICULO INNER JOIN EST_ESTACIONA
ON EST_VEICULO.PLACA = EST_ESTACIONA.PLACA_VEIC
WHERE EST_ESTACIONA.CODIGO = '1';

-- G) EXIBA A PLACA, O ANO DO VEÍCULO E A DESCRIÇÃO DE SEU MODELO, SE ELE POSSUIR ANO A PARTIR DE 20000
SELECT EST_VEICULO.PLACA, EST_VEICULO.ANO, EST_MODELO.DESCR
FROM EST_MODELO INNER JOIN EST_VEICULO
ON EST_MODELO.CODMOD = EST_VEICULO.MODELO
WHERE EST_VEICULO.ANO >= 2000;

-- H) EXIBA O ENDEREÇO, A DATA DE ENTRADA E DE SAÍDA DOS ESTACIONAMENTOS DO VEÍCULO DE PLACA JEX-1010
SELECT EST_PATIO.ENDER, EST_ESTACIONA.DATA_ENTR, EST_ESTACIONA.DATA_SAIDA
FROM EST_PATIO INNER JOIN EST_ESTACIONA
ON EST_PATIO.NUM = EST_ESTACIONA.PATIO_NUM
INNER JOIN EST_VEICULO
ON EST_VEICULO.PLACA = EST_ESTACIONA.PLACA_VEIC
WHERE EST_VEICULO.PLACA = 'JEX-1010';

-- I) EXIBA A QUANTIDADE DE VEZES OS VEÍCULOS DE COR VERDDE ESTACIONARAM
SELECT COUNT(EST_ESTACIONA.PLACA_VEIC) AS QTDE_VEICULOS_VERDES
FROM EST_ESTACIONA INNER JOIN EST_VEICULO
ON EST_ESTACIONA.PLACA_VEIC = EST_VEICULO.PLACA
WHERE EST_VEICULO.COR = 'VERDE';

-- J) LISTE TODOS OS CLIENTES QUE POSSUEM CARRO DE MODELO 1
SELECT EST_CLIENTE.CPF, EST_CLIENTE.NOME
FROM EST_CLIENTE INNER JOIN EST_VEICULO
ON EST_CLIENTE.CPF = EST_VEICULO.CLIENTE_CPF
WHERE EST_VEICULO.MODELO = '1';

-- K) LISTE AS PLACAS, OS HORÁRIOS DE ENTRADA E SAÍDA DOS VEÍCULOS DE COR VERDE
SELECT EST_VEICULO.PLACA, EST_ESTACIONA.HORA_ENTR, EST_ESTACIONA.HORA_SAIDA
FROM EST_VEICULO INNER JOIN EST_ESTACIONA
ON EST_ESTACIONA.PLACA_VEIC = EST_VEICULO.PLACA
WHERE EST_VEICULO.COR = 'VERDE';

-- L) LISTE TODOS OS ESTACIONAMENTOS DO VEÍCULO DE PLACA JJJ-2020
SELECT EST_ESTACIONA.* 
FROM EST_ESTACIONA INNER JOIN EST_VEICULO
ON EST_VEICULO.PLACA = EST_ESTACIONA.PLACA_VEIC
WHERE EST_ESTACIONA.PLACA_VEIC = 'JJJ-2020';

-- M) EXIBA O NOME DO CLIENTE QUE POSSUI O VEÍCULO CUJO CÓDIGO DE ESTACIONAMENTO É 2
SELECT EST_CLIENTE.NOME
FROM EST_CLIENTE INNER JOIN EST_VEICULO
ON EST_CLIENTE.CPF = EST_VEICULO.CLIENTE_CPF
INNER JOIN EST_ESTACIONA
ON EST_VEICULO.PLACA = EST_ESTACIONA.PLACA_VEIC
WHERE CODIGO = '2';

-- N) EXIBA O CPF DO CLIENTE QUE POSSUI O VEICULO CUJO CÓDIGO DO ESTACIONAMENTO É 3
SELECT EST_CLIENTE.CPF 
FROM EST_CLIENTE INNER JOIN EST_VEICULO
ON EST_CLIENTE.CPF = EST_VEICULO.CLIENTE_CPF
INNER JOIN EST_ESTACIONA
ON EST_VEICULO.PLACA = EST_ESTACIONA.PLACA_VEIC
WHERE EST_ESTACIONA.CODIGO = '3';

-- O) EXIBA A DESCRIÇÃO DO MODELO DO VEÍCULO CUJO CÓDIGO DO ESTACIONAMENTO É 2
SELECT EST_MODELO.DESCR
FROM EST_MODELO INNER JOIN EST_VEICULO
ON EST_MODELO.CODMOD = EST_VEICULO.MODELO
INNER JOIN EST_ESTACIONA
ON EST_VEICULO.PLACA = EST_ESTACIONA.PLACA_VEIC
WHERE EST_ESTACIONA.CODIGO = '2';

-- P) EXIBA A PLACA, O NOME DOS DONOS E A DESCRIÇÃO DOS MODELOS DE TODOS OS VEÍCULOS
SELECT EST_VEICULO.PLACA, EST_CLIENTE.NOME, EST_MODELO.DESCR
FROM EST_CLIENTE INNER JOIN EST_VEICULO
ON EST_CLIENTE.CPF = EST_VEICULO.CLIENTE_CPF
INNER JOIN EST_MODELO
ON EST_MODELO.CODMOD = EST_VEICULO.MODELO;